!function(){"use strict";angular.module("os-esri-components",["ng-sortable","ngTouchstart"])}(),function(){"use strict";function e(e,n,t){function o(){function e(){i>=o&&t.reject("max retry count reached"),a.map&&a.map.loaded?t.resolve("map loaded"):setTimeout(function(){e()},100),i++}var t=n.defer(),o=10,i=0;return e(),t.promise}var a=this;this.map,this.isMapLoaded=!1,this.layers=[];var i;require(["esri/map","esri/layers/FeatureLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/InfoTemplate","dojo/domReady!"],function(e,n,t,o){i=e,a.newFeatureLayer=n,a.newDynamicLayer=t,a.newInfoTemplate=o}),this.createMap=function(n){return i?(this.map=new i("map",n),this.map.on("layers-removed",function(n){e.$emit("os-map-layerremove",{map:this.map,evt:n})}),this.map.on("load",function(n){e.$emit("os-map-loaded",{evt:n,map:this.map})}),this.map.on("layer-add",function(n){e.$emit("os-map-layeradd",{map:this.map,evt:n})}),this.map):void setTimeout(function(){a.createMap(n)},200)},this.getMap=function(e){return this.map},this.addFeatureLayer=function(e,n,t){return o().then(function(){var o={mode:a.newFeatureLayer.MODE_SNAPSHOT,outFields:["*"],infoTemplate:t?new a.newInfoTemplate(t):""},i=a.newFeatureLayer(e,o);return a.map.addLayer(i),a.layers.push({id:i.id,name:n||" ",type:"FeatureLayer",visible:i.visible,opacity:i.opacity}),console.log(a.layers),i})},this.addDynamicLayer=function(e,n){return o().then(function(){var t=a.newDynamicLayer(e);return a.map.addLayer(t),a.layers.push({id:t.id,name:n||" ",type:"DynamicLayer",visible:t.visible,opacity:t.opacity}),t})},this.getLayer=function(e){var n=this.layers.filter(function(n,t,o){return n.name===e});return n[0]},this.getLayers=function(){return this.layers}}angular.module("os-esri-components").service("OsMapService",e)}(),function(){function e(){function e(e,n,t){var o=this;o.maps=o.baseMaps||["streets","satellite","hybrid","topo","gray","terrain"],o.changeBaseMap=function(e){t.getMap().setBasemap(e)}}return{templateUrl:"basemaps.html",controller:e,controllerAs:"vm",bindings:{baseMaps:"<"}}}angular.module("os-esri-components").component("osBasemapToggle",e())}(),angular.module("os-esri-components").directive("ngDraggable",function(e,n){function t(n,t,o){function a(e){u=e.pageY-s,c=e.pageX-r,t.css({top:u+"px",left:c+"px"})}function i(){e.unbind("mousemove",a),e.unbind("mouseup",i)}var r=0,s=0,c=0,u=0;t.on("mousedown",function(n){r=n.pageX-c,s=n.pageY-u,e.on("mousemove",a),e.on("mouseup",i)})}return{link:t}}),function(){function e(){function e(e,n){var t=this;t.$postLink=function(){n.addDynamicLayer(t.durl,t.dname)}}return{controller:e,controllerAs:"vm",bindings:{durl:"@",dname:"@",osInfoTemplateTitle:"@",osInfoTemplateBody:"@"},require:{mapCtrl:"^osMap"}}}angular.module("os-esri-components").component("osDynamicLayer",e())}(),function(){"use strict";function e(){function e(e,n){var t=this;t.$postLink=function(){var e=t.infoTemplate?t.infoTemplate:void 0;n.addFeatureLayer(t.furl,t.fname,e).then(function(e){var n=e;n.on("click",function(e){t.fclick({evt:e})})})}}return{controller:e,controllerAs:"vm",bindings:{furl:"@",fname:"@",infoTemplate:"<",fclick:"&"}}}angular.module("os-esri-components").component("osFeatureLayer",e())}(),function(){function e(){function e(e,n){var t=this;t.$postLink=function(){e.$on("os-map-loaded",function(e,t){require(["esri/dijit/HomeButton","dojo/domReady!"],function(e){var t=new e({map:n.getMap()},"HomeButton");t.startup()})})}}return{controller:e,controllerAs:"vm",bindings:{osClass:"@"},template:'<div id="HomeButton" class = "{{vm.osClass}}"> </div>'}}angular.module("os-esri-components").component("osHomeButton",e())}(),function(){function e(){function e(e,n,t){function o(e){i.layers=[],t.getLayers().forEach(function(e,n,o){var r=t.getLayer(e.name);a(r)&&(console.log(r.visible),i.layers.push({name:e.name||r._attrs.name||r.id,id:r.id,opacity:r.opacity,visible:r.visible}),i.test[r.id]=r.opacity),setTimeout(function(e){componentHandler.upgradeAllRegistered()},200)})}function a(e){var n=i.layers.map(function(e){return e.id});return-1===n.indexOf(e.id)}var i=this;i.test={},i.layers=[],i.map=t.getMap(),i.barConfig={group:"foobar",animation:150,disabled:!1,onSort:function(e){i.layers.forEach(function(e,n,o){var a=t.getMap().getLayer(e.id);t.getMap().reorderLayer(a,n)})}},n.$watch("vm.test",function(e,n){for(var o in e)if(e[o]!==n[o]){var a=t.getMap().getLayer(o);a.setOpacity(e[o])}},!0),i.stop=function(e){i.barConfig.disabled=!0},i.start=function(){i.barConfig.disabled=!1},i.setopacity=function(e,n){},i.setViz=function(e,n){var o=t.getMap().getLayer(e);o.setVisibility(n.target.checked)},i.finished=function(){setTimeout(function(e){componentHandler.upgradeAllRegistered()},200)},e.$on("os-map-loaded",function(e,n){o(t.getMap())}),e.$on("os-map-layeradd",function(){o(t.getMap())})}return{controller:e,controllerAs:"vm",bindings:{osClass:"@",isSortable:"<",layers:"<"},templateUrl:"layerlist.html"}}angular.module("os-esri-components").component("osLayerList",e())}(),function(){function e(){function e(e,n){var t=this;t.$onInit=function(){e.$on("os-map-loaded",function(e,t){require(["esri/dijit/LocateButton"],function(e){var t=new e({map:n.getMap()},"LocateButton");t.startup()})})}}return{controller:e,controllerAs:"vm",bindings:{osClass:"@"},template:'<div id="LocateButton" class = "{{vm.osClass}}"> </div>'}}angular.module("os-esri-components").component("osLocateButton",e())}(),function(){"use strict";function e(){function e(e,n){var t,o=this;t=n.createMap(o.mapDefination)}return{bindings:{mapDefination:"<"},controller:e,controllerAs:"vm",transclude:!0,template:"<div id= 'map' ><ng-transclude> </ng-transclude> </div>"}}angular.module("os-esri-components").component("osMap",e())}(),function(){function e(){function e(){var e=this;e.$postLink=function(){require(["esri/dijit/Search","dojo/domReady!"],function(n){var t=new n({enableButtonMode:!0,enableLabel:!1,enableInfoWindow:!0,showInfoWindowOnSelect:!1,map:e.mapCtrl.map},"search");t.startup()})}}return{template:'<div id="search"></div>',controller:e,controllerAs:"vm",bindings:{},require:{mapCtrl:"^osMap"}}}angular.module("os-esri-components").component("osSearch",e())}(),function(){"use strict";function e(e,n,t){function o(){}var a=this;a.showLayers=!1,a.showBasemaps=!1,o(),a.maps=["streets","satellite"],a.wellsInfo={title:"Wells",content:"Current Owner: ${CURR_OWNER}</br>Original Owner: ${ORIG_OWNER}</br>ID : ${well_id} </br>USE: ${USE_ }</br>"},a.togleLayers=function(e){a.showLayers=!a.showLayers},a.togleLayers=function(e){a.showLayers=!a.showLayers},a.toggleBaseMaps=function(){a.showBasemaps=!a.showBasemaps},a.bMapShow=function(e){a.showBasemaps=e},a.layersShow=function(e){a.showLayers=e},a.testClick=function(e){console.log("test click"),console.log(e),alert(JSON.stringify(e.graphic.geometry)),alert(JSON.stringify(e.graphic.attributes))}}angular.module("os-esri-components").controller("main",e),e.$inject=["$scope","$rootScope","OsMapService"]}();